"undefined"==typeof window&&(window=function(){}),"undefined"==typeof module&&"undefined"==typeof window.module&&(module={});var apimodule_prelude=function(e){var n={_apiKey:null,_session:null,_userStatus:"unknown",_cookieName:null,_logging:!0,copy:function(e,n,o,t){for(var i in n)(o||"undefined"==typeof e[i])&&(e[i]=t?t(n[i]):n[i]);return e},create:function(n,o){for(var t=e,i=n?n.split("."):[],r=i.length,s=0;r>s;s++){var u=i[s],a=t[u];a||(a=o&&s+1==r?o:{},t[u]=a),t=a}return t},provide:function(n,o,t){return e.copy("string"==typeof n?e.create(n):n,o,t)},guid:function(){return"f"+(Math.random()*(1<<30)).toString(16).replace(".","")},log:function(n){e._logging&&(window.Debug&&window.Debug.writeln?window.Debug.writeln(n):window.console&&window.console.log(n)),e.Event&&e.Event.fire("vd.log",n)},error:function(n){window.console&&window.console.error("Error JS coverage :"+n),e.Event&&e.Event.fire("vd.error",n)},$:function(e){return document.getElementById(e)}};for(var o in n)e[o]=n[o]};"undefined"==typeof exports&&(window.exports={});var init=this.init=exports.init=apimodule_prelude;"undefined"!=typeof window&&(window.VD={},init(window.VD));var VD_CONFIG=module.exports={get:function(){return{api:{oauth_uri:"https://secure.viadeo.com",oauth_token_path:"/oauth-provider/token",oauth_authorize_path:"/oauth-provider/authorize2",api_uri:function(e){var n="https://api.viadeo.com/";return e&&"profile"==e&&(n="https://partners-api.viadeo.com/"),n}}}}},require=require;require||(require=function(e){return"viadeoapi"==e?{VD:VD}:"config"==e?VD_CONFIG:void 0});var apimodule_event=function(e){e.provide("EventProvider",{subscribers:function(){return this._subscribersMap||(this._subscribersMap={}),this._subscribersMap},subscribe:function(e,n){var o=this.subscribers();o[e]?o[e].push(n):o[e]=[n]},unsubscribe:function(n,o){var t=this.subscribers()[n];e.Array.forEach(t,function(e,n){e==o&&(t[n]=null)})},monitor:function(e,n){if(!n()){var o=this,t=function(){n.apply(n,arguments)&&o.unsubscribe(e,t)};this.subscribe(e,t)}},clear:function(e){delete this.subscribers()[e]},fire:function(){var n=Array.prototype.slice.call(arguments),o=n.shift();e.Array.forEach(this.subscribers()[o],function(e){e&&e.apply(this,n)})}}),e.provide("Event",e.EventProvider)},init=this.init=exports.init=apimodule_event;"undefined"!=typeof window.document&&"undefined"==typeof XLP&&init(window.VD);var require=require,apimodule_qs=function(e){e.provide("QS",{encode:function(n,o,t){o=void 0===o?"&":o,t=t===!1?function(e){return e}:encodeURIComponent;var i=[];return e.Array.forEach(n,function(e,n){null!==e&&"undefined"!=typeof e&&i.push(t(n)+"="+t(e))}),i.sort(),i.join(o)},decode:function(e){var n,o,t=decodeURIComponent,i={},r=t(e).split("&");for(n=0;n<r.length;n++)o=r[n].split("=",2),o&&o[0]&&(i[t(o[0])]=o[1]?t(o[1].replace(/\+/g,"%20")):"");return i}})},init=this.init=exports.init=apimodule_qs;"undefined"!=typeof window.document&&"undefined"==typeof XLP&&init(window.VD);var apimodule_auth=function(e){e.provide("",{getLoginStatus:function(n){n&&n({status:e._userStatus,session:e._session})},getSession:function(){return e._session&&"expires"in e._session&&e._session.expires>0&&(new Date).getTime()>1e3*e._session.expires&&e.Auth.setSession(null,"notConnected"),e._session},login:function(n,o){var t=window.location.href;if("undefined"!=typeof window&&"undefined"!=typeof window.document){var i="undefined"!=typeof window.screenX?window.screenX:window.screenLeft,r="undefined"!=typeof window.screenY?window.screenY:window.screenTop,s="undefined"!=typeof window.outerWidth?window.outerWidth:document.documentElement.clientWidth,u="undefined"!=typeof window.outerHeight?window.outerHeight:document.documentElement.clientHeight-22,a=780,c=450,d=parseInt(i+(s-a)/2,10),p=parseInt(r+(u-c)/2.5,10),f="width="+a+",height="+c+",left="+d+",top="+p;o=e.copy(o||{},{client_id:e._apiKey,response_type:"token",display:"popup",scope:"",state:"vdauth_"+e.guid()});var l=e.Auth.authorizeUrl+"?"+e.QS.encode(o);if(l+="&"+e.QS.encode({redirect_uri:t}),l+="&"+e.QS.encode({cancel_url:t+(t.match(/\?/)?"&":"?")+"canceled=true"}),"popup"===o.display){console.log("Open popup "+l);var v=window.open(l,"vdauth",f);n&&(e.Auth._active[o.state]={cb:n,win:v},e.Auth._popupMonitor())}else"popupInside"==o.display&&(o.display="popup"),window.location.href=l}},logout:function(n,o){e.Auth.setSession(null,"notConnected",o),e.Cookie.clear(o),n&&n()},logoutWeb:function(n,o,t){e.Cookie.clearWeb(o,t),n&&n()}});var n=require("config").get();e.provide("Auth",{authorizeUrl:n.api.oauth_uri+n.api.oauth_authorize_path,_active:{},_receivedSession:null,readFragment:function(){if("undefined"!=typeof window&&"undefined"!=typeof window.document&&"undefined"!=typeof window.location){var n=window.location.href.replace("?","#"),o=n.substr(n.lastIndexOf("#")+1);if(o.indexOf("access_token=")>=0||o.indexOf("error=")>=0){var t=e.QS.decode(o);window.opener&&window.opener.VD.Auth.setSession&&"vdauth"==window.name&&"vdauth"!=window.opener.name?(document.documentElement.style.display="none",window.opener.VD.Auth.recvSession(t)):t&&"state"in t&&0==t.state.indexOf("vdauth_")&&("access_token"in t&&(e.Auth._receivedSession=t),window.location.hash=n.substr(0,n.lastIndexOf("#")))}}},recvSession:function(n){return n||e.error("Received invalid session"),"error"in n&&e.error("Received auth error `"+n.error+"': "+n.error_description),"state"in n?n.state in e.Auth._active?void(e.Auth._active[n.state].session=n):void e.error("Received a session from an inactive window"):void e.error("Received a session with not `state' field")},setSession:function(n,o,t){var i=!e._session&&n,r=e._session&&!n,s=!1,u=i||r||e._session&&n&&e._session.access_token!=n.access_token||e._session&&n&&e._session.expires_in!=n.expires_in,a=o!=e._userStatus;n&&"expires_in"in n&&(n.expires=Math.round((new Date).getTime()/1e3)+parseInt(n.expires_in,10),delete n.expires_in);var c={session:n,status:o};return e._session=n,e._userStatus=o,n&&"undefined"!=typeof n.access_token&&(e.access_token=n.access_token),u&&e.Cookie&&e.Cookie.getEnabled()&&e.Cookie.set(n,t),a&&e.Event.fire("auth.statusChange",c),(r||s)&&e.Event.fire("auth.logout",c),(i||s)&&e.Event.fire("auth.login",c),u&&e.Event.fire("auth.sessionChange",c),c},_popupMonitor:function(){for(var n in e.Auth._active){if("win"in e.Auth._active[n])try{e.Auth._active[n].win.closed&&(delete e.Auth._active[n].win,e.Auth.recvSession({error:"access_denied",error_description:"Client closed the window",state:n}))}catch(o){}if("session"in e.Auth._active[n]){var t=e.Auth._active[n];delete e.Auth._active[n];var i=t.session;"access_token"in i?e.Auth.setSession(i,"connected"):e.Auth.setSession(null,"notConnected"),"win"in t&&t.win.close(),"cb"in t&&t.cb({status:e._userStatus,session:e._session})}}var r=!1;for(var n in e.Auth._active){r=!0;break}r&&!e.Auth._popupInterval?e.Auth._popupInterval=window.setInterval(e.Auth._popupMonitor,100):!r&&e.Auth._popupInterval&&(window.clearInterval(e.Auth._popupInterval),e.Auth._popupInterval=null)}}),e.Auth.readFragment()},init=this.init=exports.init=apimodule_auth;"undefined"!=typeof window.document&&"undefined"==typeof XLP&&init(window.VD),"undefined"==typeof window.document&&(window=function(){},window.setTimeout=function(){}),window.console||(window.console={log:function(){},error:function(){}});var require=require,apimodule_init=function(e){e.provide("",{init:function(n){if(n=e.copy(n||{},{logging:!0}),e._apiKey=n.apiKey,"undefined"==typeof n.cookieName||!n.cookieName){var o=require("config").get();n.cookieName="undefined"!=typeof o.api.cookieName?o.api.cookieName:null}e._cookieName=n.cookieName||"vds_"+e._apiKey,e._accessToken=n.access_token,!n.logging&&window.location.toString().indexOf("vd_debug=1")<0&&(e._logging=!1),e._apiKey&&(e.Cookie.setEnabled(n.cookie),n.session=n.session||e.Auth._receivedSession||e.Cookie.load(),e.Auth.setSession(n.session,n.session?"connected":"unknown"),n.status&&e.getLoginStatus())}}),window.setTimeout(function(){window.vdAsyncInit&&vdAsyncInit()},0)},init=this.init=exports.init=apimodule_init;"undefined"!=typeof window.document&&"undefined"==typeof XLP&&init(window.VD);var require=require,document=window.document;document="undefined"==typeof document?{cookie:""}:document;var apimodule_cookie=function(e){e.provide("Cookie",{_domain:null,_enabled:!1,setEnabled:function(n){e.Cookie._enabled=n},getEnabled:function(){return e.Cookie._enabled},getViadeo:function(e){if(e){if(-1==e)return null;cookie=e.headers.cookie||""}else cookie=document.cookie;return console.log("COOKIE RAW: ",cookie),cookie=cookie.match("\\brememberMe=([^;,]*)\\b"),cookie&&console.log("CATCHED: ",cookie[1]),cookie?cookie[1]:null},load:function(n){var o=null,t=null,i=e._cookieName;if(n){if(-1==n)return null;o=n.headers.cookie||""}else o=document.cookie;if(o=o.match("\\b"+i+'="?([^;,]*)\\b'),vd=e.Cookie.getViadeo(n),console.log("COOKIE VD IN LOAD: "+vd),o){if(t=e.QS.decode(o[1]),console.log("SESSION FROM COOKIE: ",t),vd!=t.vd)return console.log("RETURN NULL COOKIE"),null;t.expires=parseInt(t.expires,10),e.Cookie._domain=t.base_domain}return t},setRaw:function(n,o,t,i,r){var i,s=r||e._cookieName,u=n&&0==o?null:new Date(1e3*o);"undefined"==typeof window.document?i&&i.res.cookie(s,n,{expires:u,domain:t,path:"/",httpOnly:!1}):document.cookie=s+'="'+n+'"'+(u?"; expires="+u:"")+"; path=/"+(t?"; domain="+t:"")},set:function(n,o){n&&(n.vd=e.Cookie.getViadeo(o),console.log("SET VD COOKIE: ",n),isNaN(n.expires)&&(n.expires=0),e.Cookie.setRaw(e.QS.encode(n),n.expires,n.base_domain,o),e.Cookie._domain=n.base_domain)},clear:function(n){console.log("clear cookie"),e.Cookie.setRaw("",0,e.Cookie._domain,n)},clearWeb:function(n,o){console.log("clear web cookie");var t=["apiRememberMe","rememberMe","autoReconnect","stayConnected"];for(id in t)e.Cookie.setRaw("",0,o,n,t[id])}})},init=this.init=exports.init=apimodule_cookie;"undefined"!=typeof window.document&&"undefined"==typeof XLP&&init(window.VD),this.JSON||(this.JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var n=meta[e];return"string"==typeof n?n:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,n){var o,t,i,r,s,u=gap,a=n[e];switch(a&&"object"==typeof a&&"function"==typeof a.toJSON&&(a=a.toJSON(e)),"function"==typeof rep&&(a=rep.call(n,e,a)),typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(a)){for(r=a.length,o=0;r>o;o+=1)s[o]=str(o,a)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+u+"]":"["+s.join(",")+"]",gap=u,i}if(rep&&"object"==typeof rep)for(r=rep.length,o=0;r>o;o+=1)t=rep[o],"string"==typeof t&&(i=str(t,a),i&&s.push(quote(t)+(gap?": ":":")+i));else for(t in a)Object.hasOwnProperty.call(a,t)&&(i=str(t,a),i&&s.push(quote(t)+(gap?": ":":")+i));return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+u+"}":"{"+s.join(",")+"}",gap=u,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,n,o){var t;if(gap="",indent="","number"==typeof o)for(t=0;o>t;t+=1)indent+=" ";else"string"==typeof o&&(indent=o);if(rep=n,n&&"function"!=typeof n&&("object"!=typeof n||"number"!=typeof n.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,n){var o,t,i=e[n];if(i&&"object"==typeof i)for(o in i)Object.hasOwnProperty.call(i,o)&&(t=walk(i,o),void 0!==t?i[o]=t:delete i[o]);return reviver.call(e,n,i)}var j;if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var require=require,apimodule_array=function(e){e.provide("Array",{indexOf:function(e,n){if(e.indexOf)return e.indexOf(n);var o=e.length;if(o)for(var t=0;o>t;t++)if(e[t]===n)return t;return-1},merge:function(n,o){for(var t=0;t<o.length;t++)e.Array.indexOf(n,o[t])<0&&n.push(o[t]);return n},filter:function(e,n){for(var o=[],t=0;t<e.length;t++)n(e[t])&&o.push(e[t]);return o},keys:function(e,n){var o=[];for(var t in e)(n||e.hasOwnProperty(t))&&o.push(t);return o},map:function(e,n){for(var o=[],t=0;t<e.length;t++)o.push(n(e[t]));return o},forEach:function(e,n,o){if(e)if("[object Array]"!==Object.prototype.toString.apply(e)&&(e instanceof Function||"number"!=typeof e.length))for(var t in e)(o||e.hasOwnProperty(t))&&n(e[t],t,e);else if(e.forEach)e.forEach(n);else for(var i=0,r=e.length;r>i;i++)n(e[i],i,e)}})},init=this.init=exports.init=apimodule_array;"undefined"!=typeof window.document&&"undefined"==typeof XLP&&init(window.VD);var require=require,apimodule_json=function(e){e.provide("JSON",{stringify:function(e){try{return window.Prototype&&Object.toJSON?Object.toJSON(e):JSON.stringify(e)}catch(n){throw console.log("ERROR when stringigy data :"),console.log(e),n}},parse:function(e){return JSON.parse(e)},flatten:function(n){var o={};for(var t in n)if(n.hasOwnProperty(t)){var i=n[t];if(null===i||void 0===i)continue;o[t]="string"==typeof i?i:e.JSON.stringify(i)}return o}})},init=this.init=exports.init=apimodule_json;"undefined"!=typeof window.document&&"undefined"==typeof XLP&&init(window.VD);var apimodule_network=function(e){if("undefined"!=typeof window.document)console.log("NETWORK IN BROWSER"),e.provide("Network",{connect:function(n,o,t,i){var r=e.guid(),s=document.createElement("script");o&&"get"!=o&&"GET"!=o&&(t.method=o),t.jsonp="VD.ApiServer._callbacks."+r;var u=e.ApiServer.endpoint(n)+n+(n.indexOf("?")>-1?"&":"?")+e.QS.encode(t);if(u.length>2e3)throw new Error("JSONP only support a maximum of 2000 bytes of input.");e.ApiServer._callbacks[r]=function(n){i&&i(n),delete e.ApiServer._callbacks[r],s.src=null,s.parentNode.removeChild(s)},s.src=u,document.getElementsByTagName("head")[0].appendChild(s)}});else{var n=require("log4js"),o=n.getLogger("api/network"),t=n.getLogger("api/network/data");console.log("NETWORK IN NODE"),e.provide("Network",{connect:function(n,i,r,s){var u=e.guid(),a=require("https"==e.ApiServer.proto?"https":"http"),c=function(e,n){return{error:{type:e,message:[n]}}};i&&(i=i.toUpperCase()),i&&"GET"==i&&(r.method=null);var d=e.QS.encode(r);!i||"POST"!=i&&"PUT"!=i?n="/"+n+(n.indexOf("?")>-1?"&":"?")+d:(n="/"+n+(n.indexOf("?")>-1?"&":"?")+"access_token="+r.access_token,r.access_token=null,d=e.QS.encode(r));var p={host:e.ApiServer.host,port:e.ApiServer.port,path:n,method:i};t.debug("API "+u+" CONNECT : '",p);for(var f in r){var l=r[f];l&&t.debug("API "+u+" PARAM : '"+f+"': "+l.substring(0,50)+(l.length>50?"...":""))}!i||"POST"!=i&&"PUT"!=i||(p.headers={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","Content-Length":d.length}),o.debug("API "+u+": "+n);var v=a.request(p);!i||"POST"!=i&&"PUT"!=i||v.write(d),v.end(),o.debug("API "+u+": REQUEST SENT"),v.on("response",function(e){o.debug("API "+u+": RESPONSE RECEIVED");var n="",i=100*parseInt(e.statusCode/100);o.debug("API "+u+": statusCode: ",e.statusCode),t.debug("API "+u+": headers: ",e.headers),e.on("data",function(e){n+=e}),e.on("end",function(){if(o.debug("API "+u+": REQUEST ENDED"),s){try{n=JSON.parse(n)}catch(t){o.error("API "+u+": JSON parse error: "+t),o.error(n),n={data:n}}o.debug(i),200!=i?n?s(n,e.statusCode):s(c("API Error",t),e.statusCode):s(n,e.statusCode)}})}),v.on("error",function(e){console.error("HTTP error: "+e),s(c("Connection Error",e))})}})}},init=this.init=exports.init=apimodule_network;"undefined"!=typeof window.document&&"undefined"==typeof XLP&&init(window.VD);var apimodule_api=function(e){e.provide("",{api:function(){e.ApiServer.call.apply(e.ApiServer,arguments)}});var n=require("config").get(),o=n.api.api_uri;e.provide("ApiServer",{METHODS:["get","post","put","delete"],endpoint:void 0,host:void 0,port:void 0,proto:void 0,_callbacks:{},setUrl:function(n){var t=o;n&&(t=function(){return n});var i=/^(https?):\/\/([^\/:]+)(:([0-9]+))?\/?$/,r=i.exec(t());e.ApiServer.proto=r[1];try{e.ApiServer.port=r[4]}catch(s){}e.ApiServer.port||(e.ApiServer.port="http"==e.ApiServer.proto?80:443),e.ApiServer.host=r[2],e.ApiServer.endpoint=t},call:function(){for(var n,o,t,i=Array.prototype.slice.call(arguments),r=i.shift(),s=i.shift();s;){var u=typeof s;if("string"!==u||n)if("function"!==u||t){if("object"!==u||o)return void e.log("Invalid argument passed to VD.api(): "+s);o=s}else t=s;else n=s.toLowerCase();s=i.shift()}return n=n||"get",o=o||{},"/"===r[0]&&(r=r.substr(1)),e.Array.indexOf(e.ApiServer.METHODS,n)<0?void e.log("Invalid method passed to VD.api(): "+n):void e.ApiServer.oauthRequest(r,n,o,t)},oauthRequest:function(n,o,t,i){if(e.getSession){var r=e.getSession();r&&r.access_token&&!t.access_token&&(t.access_token=r.access_token)}!t.access_token&&e._accessToken&&(t.access_token=e._accessToken),e.Network.connect(n,o,e.JSON.flatten(t),i)}}),e.ApiServer.setUrl()},init=this.init=exports.init=apimodule_api;"undefined"!=typeof window.document&&"undefined"==typeof XLP&&init(window.VD);
